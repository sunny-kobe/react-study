var LTFooter = {
    gameComDes: '健康游戏忠告：抵制不良游戏&nbsp;&nbsp;&nbsp;拒绝盗版游戏&nbsp;&nbsp;&nbsp;注意自我保护&nbsp;&nbsp;&nbsp;谨防受骗上当&nbsp;&nbsp;&nbsp;适度游戏益脑&nbsp;&nbsp;&nbsp;沉迷游戏伤身&nbsp;&nbsp;&nbsp;合理安排时间&nbsp;&nbsp;&nbsp;享受健康生活',
    style: '.LT-footer{overflow:hidden;padding:40px 0;min-width:1200px;font-size:0}.LT-footer .f-wrap{margin:0 auto;width:1000px}.LT-footer .f-a{font-family:"\5FAE\8F6F\96C5\9ED1",tahoma,sans-serif;font-size:13px;font-weight:400;font-style:normal;white-space:nowrap;text-decoration:none}.LT-footer .f-a[href]{cursor:pointer}.LT-footer .f-p,.LT-footer .f-rich-text{margin:0;line-height:2.2}.LT-footer .f-rich-text{font-size:13px}.LT-footer .f-top{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:flex-end;align-items:flex-end;-webkit-box-align:end;-webkit-box-pack:justify;-ms-flex-align:end;-ms-flex-pack:justify;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-justify-content:space-between;justify-content:space-between}.LT-footer .f-top+.f-center:before{display:block;margin:18px 0 16px;height:1px;content:""}.LT-footer .f-top .f-t-l{white-space:nowrap}.LT-footer .f-top .f-t-l .f-item,.LT-footer .f-top .f-t-l .f-line{display:inline-block;vertical-align:middle}.LT-footer .f-top .f-t-l .f-line{margin:0 16px;width:1px;height:40px}.LT-footer .f-top .f-t-r{margin-top:10px}.LT-footer .f-top .f-t-r .f-a{text-decoration:underline}.LT-footer .f-top .f-t-r .f-a+.f-a{margin-left:16px}.LT-footer .f-center .f-list{overflow:hidden}.LT-footer .f-center .f-list .f-a{display:inline-block;position:relative;margin-right:25px;vertical-align:middle}.LT-footer .f-center .f-list .f-a:before{display:inline-block;position:absolute;top:50%;left:-13px;width:1px;height:18px;-webkit-transform:translateY(-50%);transform:translateY(-50%);content:""}.LT-footer .f-center .f-list .f-a:first-child:before{display:none}.LT-footer .f-center .f-list .f-a:last-child{margin-right:0}.LT-footer .f-bottom .f-p:last-child{line-height:2.5}.LT-footer .f-bottom .f-a+.f-a{margin-left:5px}.LT-footer .f-bottom .f-a-img{display:inline-block;text-decoration:none}.LT-footer .f-bottom .f-a-img+.f-a-img{margin-left:12px}.LT-footer .f-bottom .f-a-img:hover{text-decoration:none}.LT-footer .f-bottom .f-a-img img{display:inline-block;width:auto;height:20px;vertical-align:middle}.LT-footer .f-bottom .f-a-img i{margin-left:4px;font-size:13px;font-style:normal;vertical-align:middle}.LT-footer.dark{background-color:#282f3e}.LT-footer.dark .f-a{color:#fff}.LT-footer.dark .f-a:before{background-color:#a1a1a1}.LT-footer.dark .f-a[href]:hover{color:#0089bc}.LT-footer.dark .f-rich-text{color:#fff}.LT-footer.dark .f-rich-text a{text-decoration:none;color:#fff}.LT-footer.dark .f-rich-text a[href]:hover{color:#0089bc}.LT-footer.dark .f-top .f-t-l .f-line{background-color:rgba(66,78,102,.6)}.LT-footer.dark .f-top .f-t-r .f-a{color:#0089bc}.LT-footer.dark .f-top .f-t-r .f-a[href]:hover{color:#09ade8}.LT-footer.dark .f-top+.f-center:before{background-color:rgba(83,97,128,.9)}.LT-footer.dark .f-bottom .f-a-img{color:#fff}.LT-footer.dark .f-bottom .f-a-img[href]:hover{color:#0089bc}.LT-footer.light{background-color:#fff}.LT-footer.light .f-a{color:#100f0f}.LT-footer.light .f-a:before{background-color:#a1a1a1}.LT-footer.light .f-a[href]:hover{color:#0089bc}.LT-footer.light .f-rich-text{color:#100f0f}.LT-footer.light .f-rich-text a{text-decoration:none;color:#100f0f}.LT-footer.light .f-rich-text a[href]:hover{color:#0089bc}.LT-footer.light .f-top .f-t-l .f-line{background-color:#e3e3e3}.LT-footer.light .f-top .f-t-r .f-a{color:#0089bc}.LT-footer.light .f-top .f-t-r .f-a[href]:hover{color:#00a8e5}.LT-footer.light .f-top+.f-center:before{background-color:#cecece}.LT-footer.light .f-bottom .f-a-img{color:#100f0f}.LT-footer.light .f-bottom .f-a-img[href]:hover{color:#0089bc}.LT-footer.f-mobile{padding:15px;min-width:0}.LT-footer.f-mobile .f-wrap{width:auto}.LT-footer.f-mobile .f-p{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;line-height:2;-webkit-align-items:center;align-items:center;-webkit-box-align:center;-webkit-box-pack:center;-ms-flex-align:center;-ms-flex-pack:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-justify-content:center;justify-content:center}.LT-footer.f-mobile .f-p.f-nav .f-a{text-decoration:underline}.LT-footer.f-mobile .f-p .f-a{font-size:10px}.LT-footer.f-mobile .f-p .f-a+.f-a{margin-left:5px}.LT-footer.f-mobile .f-p .f-a-img{display:inline-block;font-size:10px;text-decoration:none}.LT-footer.f-mobile .f-p .f-a-img+.f-a-img{margin-left:12px}.LT-footer.f-mobile .f-p .f-a-img img{display:inline-block;width:auto;height:20px;vertical-align:middle}.LT-footer.f-mobile .f-p .f-a-img i{font-style:normal;vertical-align:middle}.LT-footer.f-mobile .f-rich-text{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:10px;line-height:2;text-align:center;-webkit-align-items:center;align-items:center;-webkit-box-align:center;-webkit-box-pack:center;-ms-flex-align:center;-ms-flex-pack:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-justify-content:center;justify-content:center}.LT-footer.f-mobile.dark{background-color:#202020}.LT-footer.f-mobile.dark .f-p .f-a,.LT-footer.f-mobile.dark .f-p .f-a-img,.LT-footer.f-mobile.dark .f-rich-text,.LT-footer.f-mobile.dark .f-rich-text a{color:#c6c6c6}.LT-footer.f-mobile.light{background-color:#fff}.LT-footer.f-mobile.light .f-p .f-a,.LT-footer.f-mobile.light .f-p .f-a-img,.LT-footer.f-mobile.light .f-rich-text,.LT-footer.f-mobile.light .f-rich-text a{color:#c9c9c9}.LT-age{position:absolute;z-index:1}.LT-age img{max-width:200px}', // 样式代码
    data: {
        copyrightData: '', // 版权信息
        style: 'dark', // 风格['dark','light']
        wrapId: 'LT_footer', // 容器Id
        source: '', // 数据源
        device: '', // pc/mobile
        ageData: []
    },
    setHtmlForPC: function (data) {
        // 渲染pc结构

        // 版块一：f-top
        var topTpl = '';
        // f-t-l
        var topL = '';
        if (data.hasOwnProperty('logo')) {
            for (var i = 0; i < data.logo.length; i++) {
                var item = data.logo[i];
                var href = '';
                if (item.href != '') {
                    href = "target='_blank' href=" + item.href;
                }
                topL += "<a class='f-item' " + href + ">\
                            <img src='" + this.deleteHttpOrHttps(item.src) + "' alt='" + item.txt + "'>\
                        </a>";
                if (i < data.logo.length - 1) {
                    topL += "<div class='f-line'></div>";
                }
            }
        }

        // f-t-r
        var topR = '';
        if (data.hasOwnProperty('nav')) {
            for (var i = 0; i < data.nav.length; i++) {
                var item = data.nav[i];
                var href = '';
                if (item.href != '') {
                    href = "target='_blank' href=" + item.href;
                }
                topR += "<a class='f-a' " + href + ">" + item.txt + "</a>";
            }
        }

        topTpl = "<div class='f-top'>\
                    <div class='f-t-l'>" + topL + "</div>\
                    <nav class='f-t-r'>" + topR + "</nav>\
                </div>";

        // 版块二：f-center
        var centerTpl = '';
        var richInfo = '';
        if (data.hasOwnProperty('contactPc') && data.contactPc !== '') {
            richInfo = "<p class='f-rich-text'>" + data.contactPc + "</p>";
        }
        var cList = '';
        if (data.hasOwnProperty('info')) {
            for (var i = 0; i < data.info.length; i++) {
                var item = data.info[i];
                var href = '';
                if (item.href != '') {
                    href = "target='_blank' href=" + item.href;
                }
                cList += "<a class='f-a' " + href + ">" + item.txt + "</a>";
            }
        }

        centerTpl = "<div class='f-center'>\
                        <p class='f-p'>\
                            <a class='f-a'>" + this.gameComDes + "</a>\
                        </p>\
                        " + richInfo + "\
                        <p class='f-p f-list'>" + cList + "</p>\
                    </div>"

        // 版块三：f-bottom
        var bottomTpl = '';
        // f-b-l
        var bottomL = "<a class='f-a'>Copyright© " + data.copyright + "-" + new Date().getFullYear() + "</a>";
        if (data.hasOwnProperty('logo')) {
            for (var i = 0; i < data.logo.length; i++) {
                var item = data.logo[i];
                var href = '';
                if (item.href != '') {
                    href = "target='_blank' href=" + item.href;
                }
                bottomL += "<a class='f-a' " + href + ">" + item.txt + "</a>";
            }
        }

        // f-b-r
        var bottomR = '';
        if (data.hasOwnProperty('icon')) {
            for (var i = 0; i < data.icon.length; i++) {
                var item = data.icon[i];
                var href = '';
                var txt = '';
                if (item.href != '') {
                    href = "target='_blank' href=" + item.href;
                }
                if (item.txt != '') {
                    txt = "<i>" + item.txt + "</i>";
                }
                bottomR += "<a class='f-a-img' title='" + item.alt + "' " + href + ">\
                                <img src='" + this.deleteHttpOrHttps(item.src) + "' height='20' alt='" + item.alt + "'>\
                                " + txt + "\
                            </a>";
            }
        }

        bottomTpl = "<div class='f-bottom'>\
                        <p class='f-p'>" + bottomL + "</p>\
                        <p class='f-p'>" + bottomR + "</p>\
                    </div>";

        // 版权
        var footerTpl = "<style>" + this.style + "</style><div class='LT-footer " + this.data.style + "'>\
            <div class='f-wrap'>" + topTpl + centerTpl + bottomTpl + "</div>\
        </div>";

        return footerTpl;
    },
    setHtmlForMobile: function (data) {
        // 渲染mobile结构
        var nav = '';
        if (data.hasOwnProperty('nav')) {
            for (var i = 0; i < data.nav.length; i++) {
                var item = data.nav[i];
                if (item.hasOwnProperty('mobileNeedShow') && item.mobileNeedShow == '1') {
                    var href = '';
                    if (item.href != '') {
                        href = "target='_blank' href=" + item.href;
                    }
                    nav += "<a class='f-a' " + href + ">" + item.txt + "</a>";
                }
            }
        }

        var info = '';
        if (data.hasOwnProperty('info')) {
            for (var i = 0; i < data.info.length; i++) {
                var item = data.info[i];
                if (item.hasOwnProperty('mobileNeedShow') && item.mobileNeedShow == '1') {
                    var href = '';
                    if (item.href != '') {
                        href = "target='_blank' href=" + item.href;
                    }
                    info += "<a class='f-a' " + href + ">" + item.txt + "</a>";
                }
            }
        }

        var copyright = "<a class='f-a'>Copyright© " + data.copyright + "-" + new Date().getFullYear() + "</a>";
        if (data.hasOwnProperty('logo')) {
            for (var i = 0; i < data.logo.length; i++) {
                var item = data.logo[i];
                var href = '';
                if (item.href != '') {
                    href = "target='_blank' href=" + item.href;
                }
                copyright += "<a class='f-a' " + href + ">" + item.txt + "</a>";
            }
        }

        var richInfo = '';
        if (data.hasOwnProperty('contactMobile') && data.contactMobile !== '') {
            richInfo = "<p class='f-rich-text'>" + data.contactMobile + "</p>";
        }

        var iconList = '';
        if (data.hasOwnProperty('icon')) {
            for (var i = 0; i < data.icon.length; i++) {
                var item = data.icon[i];
                if (item.hasOwnProperty('mobileNeedShow') && item.mobileNeedShow == '1') {
                    var href = '';
                    var txt = '';
                    if (item.href != '') {
                        href = "target='_blank' href=" + item.href;
                    }
                    if (item.txt != '') {
                        txt = "<i>" + item.txt + "</i>";
                    }
                    iconList += "<a class='f-a-img' title='" + item.alt + "' " + href + ">\
                                    <img src='" + item.src + "' height='20' alt='" + item.alt + "'>\
                                    " + txt + "\
                                </a>";
                }
            }
        }

        // 版权
        var footerTpl = "<style>" + this.style + "</style><div class='LT-footer f-mobile " + this.data.style + "'>\
                            <div class='f-wrap'>\
                                <p class='f-p f-nav'>" + nav + "</p>\
                                <p class='f-p'>" + info + "</p>\
                                <p class='f-p'>" + copyright + "</p>\
                                " + richInfo + "\
                                <p class='f-p'>" + iconList + "</p>\
                            </div>\
                        </div>";

        return footerTpl;
    },
    setFooter: function () {
        // 站点和游戏数据整合
        var data = this.data.copyrightData;
        if (!data) {
            console.error('无效的域名，请核对后联系管理员添加该域名信息。');
            return;
        }

        if (this.pcOrMobile() === 'mobile') {
            document.getElementById(this.data.wrapId).innerHTML = this.setHtmlForMobile(data);
        } else {
            document.getElementById(this.data.wrapId).innerHTML = this.setHtmlForPC(data);
        }
    },
    getData: function (key, tongji) {
        var e = document.createElement("script");
        var src = this.data.source + "/api/footer/" + key + ".js";
        if (tongji) {
            src += '?tj=' + tongji;
        }
        e.setAttribute("src", src);
        var jsList = document.getElementsByTagName('script');
        var loaded = false;
        for (var i = 0; i < jsList.length; i++) {
            if (this.deleteHttpOrHttps(jsList[i].src) === src) {
                loaded = true;
                continue;
            }
        }
        if (!loaded) {
            document.body.appendChild(e);
            e.onload = function () {
                LTFooter.data.copyrightData = _footerData;
                LTFooter.setFooter();
                LTFooter.data.ageData = _ageData || [];
                LTFooter.setAge();
            };
            e.onerror = function () {
                console.warn("配置的key值有误，获取版号信息错误。");
            };
        } else {
            LTFooter.data.copyrightData = _footerData;
            LTFooter.setFooter();
            LTFooter.data.ageData = _ageData || [];
            LTFooter.setAge();
        }
    },
    deleteHttpOrHttps: function (src) {
        // 处理外链地址（目前只处理图片、js路径判断）
        var reg = new RegExp(/^https?:/);
        var s = src.replace(reg, "");
        return s;
    },
    pcOrMobile: function () {
        // 根据pc或是mobile返回对应的html结构
        var userAgentInfo = navigator.userAgent.toLowerCase();
        var isMobile = userAgentInfo.match(/(iphone|ipod|android|ios|ipad|backerry|webos|symbian|windows phone|phone|mobile|webos|incognito|webmate|bada|nokia|lg|ucweb|skyfire)/i);
        var fixIpad = navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1; // 兼容：iPad-设置-Safar浏览器-请求桌面网站-所有网站（开启）

        if (this.data.device === 'mobile') {
            return 'mobile';
        }
        if (this.data.device === 'pc') {
            return 'pc';
        }

        if (isMobile || fixIpad) {
            return 'mobile';
        } else {
            return 'pc';
        }
    },
    setAge: function () {
        // 筛选年龄标识数据
        var data = this.data.ageData;
        if (data.length === 0) {
            return false;
        }
        var currentUrl = this.manageAgeSrc(window.location.host + window.location.pathname);
        for (var i = 0; i < data.length; i++) {
            var el = data[i];
            var url = this.manageAgeSrc(el.url);
            if (currentUrl === url || currentUrl === 'test' + url) {
                this.setAgeHtml(data[i]);
                break;
            }
        }
    },
    manageAgeSrc: function (src) {
        // 处理age配置地址
        var head = new RegExp(/^(https?:\/\/)|(\/\/)/);
        var footer = new RegExp(/\/$/);
        var s = src.replace(head, '').replace(footer, '');
        return s;
    },
    setAgeHtml: function (data) {
        // 渲染年龄标识dom
        var device = this.pcOrMobile();
        var tpl = '';
        var wrapStyle = '';
        var imgW = ''; // 标识宽度
        var tOrB = parseInt(data[device].y) >= 0 ? 'top' : 'bottom'; // 上下定位
        var lOrR = parseInt(data[device].x) >= 0 ? 'left' : 'right'; // 左右定位
        var unit = ''; // 单位
        var multiple = 1; // 倍数
        if (typeof (LTRem) !== 'undefined') {
            // 兼容rem布局
            unit = 'rem';
            multiple = 100;
        } else {
            unit = 'px';
            if (device === 'mobile') {
                // 移动端
                multiple = 2;
            } else {
                // pc端
                multiple = 1;
            }
        }

        wrapStyle = tOrB + ':' + Math.abs(parseInt(data[device].y) / multiple) + unit + ';' +
            lOrR + ':' + Math.abs(parseInt(data[device].x) / multiple) + unit + ';'
        imgW = Math.abs(parseInt(data[device].width) / multiple) + unit + ';'

        var wrap = document.createElement('div');
        wrap.setAttribute('id', 'LT_age');
        wrap.setAttribute('class', 'LT-age');
        wrap.setAttribute('style', wrapStyle);
        if (data[device].href !== '') {
            tpl = "<a href='" + data[device].href + "' target='_blank'>\
                <img src='" + data[device].img + "' style='width:" + imgW + "'>\
            </a>";
        } else {
            tpl = "<a>\
                <img src='" + data[device].img + "' style='width:" + imgW + "'>\
            </a>";
        }

        if (document.getElementById('LT_age') === null) {
            // 避免重复调用插入dom
            if (data[device].wrap !== '' && document.querySelectorAll(data[device].wrap).length > 0) {
                // 优先级1：显示在配置的dom位置
                var ancestorWrap = document.querySelectorAll(data[device].wrap)[0];
                var position = window.getComputedStyle(ancestorWrap).getPropertyValue('position');
                if (position === 'static') {
                    ancestorWrap.style.position = 'relative';
                }
                document.querySelectorAll(data[device].wrap)[0].appendChild(wrap);
            } else if (document.querySelectorAll("[data-lt-age='true']").length > 0) {
                // 优先级2：显示在data-lt-age='true'的dom位置
                var ancestorWrap = document.querySelectorAll("[data-lt-age='true']")[0];
                var position = window.getComputedStyle(ancestorWrap).getPropertyValue('position');
                if (position === 'static') {
                    ancestorWrap.style.position = 'relative';
                }
                document.querySelectorAll("[data-lt-age='true']")[0].appendChild(wrap);
            } else {
                // 优先级3：默认根据body来定位
                document.body.appendChild(wrap);
            }
        }

        document.getElementById('LT_age').innerHTML = tpl;
        return tpl;
    },
    init: function (id) {
        // 初始化
        var ID = id || 'LT_footer';

        if (!document.getElementById(ID)) {
            console.warn('需先初始化 ' + ID + ' 容器。');
            return;
        }

        this.data.wrapId = ID;
        this.data.style = document.getElementById(ID).getAttribute('data-color') || 'dark';
        this.data.key = document.getElementById(ID).getAttribute('data-key') || '';
        this.data.source = document.getElementById(ID).getAttribute('data-source') || '//game.leiting.com';
        this.data.tongji = document.getElementById(ID).getAttribute('data-tongji') || '';
        this.data.device = document.getElementById(ID).getAttribute('data-type') || '';

        if (this.data.key == '') {
            console.warn('footer未设置key值，与管理员确认后填写。');
            return;
        }
        LTFooter.getData(this.data.key, this.data.tongji);
    }
};

LTFooter.init();